---
date: 2024-03-31
category:
  - web
tag:
  - http
---

# HTTPS协议

HTTPS协议是对HTTP协议的一种扩展，在HTTP的基础上加入了[SSL\/TLS][1]协议进行数据加密和认证。使得通过HTTPS传输的数据更加安全可靠

>  HTTPS = HTTP + 加密 + 认证 + 完整性保护

## HTTP的缺陷

- HTTP协议传输的数据是明文的，未经过加密处理，任何人都可以截获传输的数据并进行监听
- HTTP协议没有对传输的数据进行完整性校验的机制，意味着在传输过程中数据可能会被篡改
- HTTP协议本身没有提供对服务器或客户端身份进行验证的机制

## 加密方式

- 对称加密: 算法公开、计算量小、加密速度快、加密效率高。
- 非对称加密: 算法复杂、运算速度慢、加密效率低。

HTTPS采用非对称加密 + 对称加密 + CA证书认证，在交换密钥环节使用非对称加密方式，建立通信交换报文阶段则使用对称加密方式。提高了密钥交换的安全性，又减少了通信过程中的加密解密开销。但即便如此，依旧存在数据数据被伪装篡改的风险(中间人攻击)，为了解决这些问题加入了CA证书认证

## CA证书

服务端在使用HTTPS前，需要向CA机构申领一份数字证书，数字证书⾥含有证书申请者信息、公钥信息等。服务器把证书传输给浏览器，浏览器从证书里获取公钥就行了，证书就如身份证，证明服务端公钥的权威性。

证书所包含的主要信息：

- 证书持有人信息
- 证书持有人的公钥
- 证书颁发机构信息
- 证书序列号
- 证书的有效期限
- 数字签名

数字签名过程:

1. CA机构拥有非对称加密的私钥A和公钥A'
2. CA机构对服务端申请的证书明文数据进行hash，形成数据摘要
3. 然后对数据摘要用CA私钥A'加密，得到数字签名S

> 服务端申请的证书明文 + 数字签名S -> 数字证书

特点：

1. 唯一性：理论上，不同的数据生成的数字摘要应该是唯一的。即使数据中只有微小的差异，生成的数字指纹也会有显著的变化。
2. 不可逆性：数字指纹的生成算法具有不可逆性，不能通过数字指纹还原出原始数据。这样可以保护原始数据的机密性。
3. 固定长度：生成的数字指纹具有固定的长度。不论输入数据多长，都会生成指定长度的数字指纹。
4. 敏感性：对于输入数据的微小改动，生成的数字指纹也会有较大的差异。这使得数字指纹可以用于检测数据是否被篡改。

认证过程：

1. 客户端请求：当客户端与服务器进行通信时，服务器会将其CA证书发送给客户端。
2. 证书解析：客户端收到服务器的证书后，首先会对证书进行解析，提取其中的信息。
3. CA证书验证：客户端使用预先内置或可信任的根证书（Root Certificate）或中间证书（Intermediate Certificate）对接收到的CA证书进行验证。
4. 验证签名：接收者获取到原始数据、数字签名和签名者的公钥（公钥也可能会在浏览器中保存）。接收者使用签名者的公钥（CA公钥是公开的）对数字签名进行解密操作，得到解密后的数据摘要。然后，接收者对原始数据进行同样的哈希计算，生成新的数据摘要。最后将两个数据摘要进行比较，如果相同，则说明数据完整且未被篡改，数字签名有效。
5. 证书链验证：如果颁发该证书的证书颁发机构是中间证书颁发机构，客户端还需要使用内置的根证书验证其合法性。这个验证过程称为证书链验证，确保整个证书链的信任和完整性。
6. 证书有效期验证：客户端检查证书中的有效期限，确保该证书仍在有效期内。过期的证书将被认为不受信任。
7. 身份和安全性确认：一旦通过以上验证过程，客户端可以确认服务器的身份和证书的安全性。客户端会使用服务器证书中包含的公钥对通信过程中的数据进行加密，并根据证书中的身份信息来判断是否信任该服务器。

[1]: ./TLS协议.md
